{% extends "base.html" %}

{% block content %}
    <h1>{{ object.character }}</h1>
    <p>{{ object.content }}</p>
    <p>{{ object.meaning }}</p>
    <p>{{ object.number }}</p>

    <h2>My Example:</h2>
    <p>{{ my_comment.text }}</p>

    <h2>Examples:</h2>
    {% for example in examples %}
        <li>{{ example.text }}
            Favorites: {{ example.favorites.count }}
            Author: {{ example.profile }}
        </li>
        <button class="like-btn" id="{{ example.id }}">Fav</button>
    {% endfor %}
    <h3>Page: {{ examples.number }}</h3>

    <h2>Best Examples:</h2>
    {% for best_example in best_examples %}
        <li>{{ best_example.text }}
            Favorites: {{ best_example.favorites.count }}
            Author: {{ example.profile }}
        </li>
        <button class="like-btn" id="{{ best_example.id }}">Fav</button>
    {% endfor %}
    <h3>Page: {{ best_examples.number }}</h3>

    <form id="add_example_form">{% csrf_token %}
        <input type="text" id="example_text">
        <label for="example_text">Example: </label>
        <input type="submit" value="Submit">
    </form>
{% endblock content %}

{% block js_scripts %}
    <script>
        let item_id = "{{ object.id }}";
        $(document).on('submit', '#add_example_form', function (e) {
            e.preventDefault();
            $.ajax({
                type: 'POST',
                url: '/kanjis/add-example/',
                data: {
                    text: $('#example_text').val(),
                    item_id: item_id,
                    csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                },
                success:function () {
                    console.log("success submit!!!");
                }
            });
        });

        $(".like-btn").click(function(e){
            e.preventDefault();
            console.log(e.target.id);
            $.ajax({
                type: 'POST',
                url: '/kanjis/favorite-example-toggle/',
                data: {
                    text: $('#example_text').val(),
                    example_id: e.target.id,
                    csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                },
                success:function () {
                    console.log("success submit!!!")
                }
            })
        });
    </script>
{% endblock js_scripts %}